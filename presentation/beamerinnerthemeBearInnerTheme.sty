\RequirePackage{calc}
\RequirePackage{eso-pic}
\RequirePackage{thmtools}

%% Options for theoremstyles
\DeclareOptionBeamer{unnumbered}{ \def \BearTheorem {}          }
\DeclareOptionBeamer{numbered}  { \def \BearTheorem {numbered}  }
\DeclareOptionBeamer{AMS}       { \def \BearTheorem {ams style} }

%% Language, so photo is correct
\DeclareOptionBeamer{eng}
{
    \def \BearLang {eng}
    \def \beamerPhoto {Photo}
}
\DeclareOptionBeamer{bm}{
    \def \BearLang {bm}
    \def \beamerPhoto {Foto}
}
\DeclareOptionBeamer{nn}{
    \def \BearLang {nn}
    \def \beamerPhoto {Foto}
}

\DeclareOptionBeamer{TitlePage} { \def \BearFirstFrame {\TitlePage}  }
\DeclareOptionBeamer{NoTitlePage} { \def \BearFirstFrame {} }


\ExecuteOptionsBeamer{eng, unnumbered, TitlePage}
\ProcessOptionsBeamer

\AtBeginDocument{ \BearFirstFrame }

\mode<presentation>

\setbeamertemplate{theorems}[\BearTheorem]
\setbeamertemplate{qed symbol}{{\(\blacksquare\)}}
\setbeamertemplate{caption label separator}{: }

\useinnertheme{rectangles}
%%%%%%%%%%%%%%%%%%%%%%%%
%%%% The front page %%%%
%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{title page}
{
    \AddToShipoutPictureFG*
    {
        \AtPageUpperLeft
        {   
            \hspace{0.4cm}
            \parbox[t][2.2cm][b]{\textwidth}
            {
                \includegraphics[height = 0.197\paperheight]{images/logo/VKIlogolong.eps} 
                \hspace{0.2cm}
                \includegraphics[height = 0.173\paperheight]{images/logo/poliMiLogoNegative.eps}
            }
        }

        % \AtPageLowerLeft
        % {
        %     \hspace{0.9cm}
        %     \parbox[b][0.12\paperheight][t]{\textwidth}
        %     {
        %         %\includegraphics[decodearray={1 .5 .5 .5 .5 .5}]{images/poliMiLogo.eps}
        %         %\includegraphics[height = 0.2\paperheight]{images/VKIlogolong.eps}
        %     }
        % }
        
        \AtPageUpperLeft
        {
            \makebox[\paperwidth][r]
            {
                \parbox[t][\paperheight][b]{4.58cm}
                {
                    \includegraphics[height = \paperheight]{images/logo/trent1000fan.png}
                    % \includegraphics[height = \paperheight, angle=90]{images/logo/siemensTurbine.jpg}
                }
            }
        }
        
        % \AtPageLowerLeft
        % {
        %     \makebox[\paperwidth][r]
        %     {
        %         \parbox[b][0.2cm][t]{4cm}
        %         {
        %             \centering
        %             \usebeamercolor[fg]{local structure}
        %             \resizebox{2cm}{!}
        %             {\OMphoto{}: Rolls Royce Trent 1000 Fan}
        %         }
        %     }
        % }
    }

    \vspace{0.5cm}
    \hspace*{0pt}
    \begin{minipage}[b][\paperheight - 3cm]{\paperwidth - 5.3cm}
        \raggedright

        \vspace{0.1\paperheight}
    
        \usebeamerfont{title}
        \inserttitle
        \\[0.2ex]
        \usebeamerfont{subtitle}
        \insertsubtitle

        \vspace{0.07\paperheight}
        
        \usebeamerfont{author}
        \insertauthor
        \newline
        
        \vspace{0.05\paperheight}
        
        \footnotesize{
            \textsc{\href{https://www.vki.ac.be/}{TP Department, von Karman Institute for Fluid Dynamics}}
            \newline
            \textsc{\href{https://www.aero.polimi.it/en}{DAER, Politecnico di Milano}}
        }
    \end{minipage}
}

\newcommand{\TitlePage}
{{
    \setbeamercolor{background canvas}{parent = title page}
    \begin{frame}[b, plain, noframenumbering]
        \titlepage
    \end{frame}
}}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Section pages %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{section page}
{
    \begin{center}
        \vskip\baselineskip
        \insertsection
    \end{center}
}

\newcommand{\SectionPage}
{{
    \setbeamercolor{background canvas}{parent = section page}
    \begin{frame}[c, plain, noframenumbering]
        
        \begin{center}    
            \vskip\baselineskip
            \vspace{1.2cm}
            \Huge \textbf{\color{c-white}{\insertsection}}
            
            \vspace{0.3cm}
            \Large \textbf{\color{c-white}{ \ }}
        \end{center}
    
    \end{frame}
}}

\newcommand{\SubSectionPage}
{{
    \setbeamercolor{background canvas}{parent = section page}
    
    \begin{frame}[c, plain, noframenumbering]
        
        \begin{center}
            \vskip\baselineskip
            \vspace{1.2cm}
            \Huge \textbf{\color{c-white}{\insertsection}}
            
            \vspace{0.3cm}
            \Large \textbf{\color{c-white}{\insertsubsection}}
        \end{center}

    \end{frame}
}}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% Blocks %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%

%% Redefine blocks with larger indentations,
%% and some environmental colours:
\setbeamertemplate{block begin}
{
    \setbeamercolor{local structure}{use = block title, fg = block title.bg}
    \setbeamercolor{item projected}{use = block title,
                                    fg = block title.fg,
                                    bg = block title.bg}

    \unskip
    \vskip1.3ex

    \begin{beamercolorbox}[ht        = 2.4  ex,
                           dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex]
                          {block title}
        \usebeamerfont*{block title}
        \insertblocktitle
    \end{beamercolorbox}

    \nointerlineskip

    \usebeamerfont{block body}
    \begin{beamercolorbox}[dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex,
                           vmode]
                          {block body}
        \vspace*{1ex}
        \begin{minipage}{\textwidth - 1.5ex}
}

\setbeamertemplate{block end}
{
        \end{minipage}
    \vskip0pt
    \end{beamercolorbox}
    \vskip1.3ex
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{block example begin}
{
    \setbeamercolor{local structure}{use = block title example, 
                                     fg = block title example.bg}
    \setbeamercolor{item projected}{use = block title example,
                                    fg = block title example.fg,
                                    bg = block title example.bg}

    \unskip
    \vskip1.3ex

    \begin{beamercolorbox}[ht        = 2.4  ex,
                           dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex]
                          {block title example}

        \usebeamerfont*{block title example}
        \insertblocktitle
    \end{beamercolorbox}

    \nointerlineskip

    \usebeamerfont{block body example}
    \begin{beamercolorbox}[dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex,
                           vmode]
                          {block body example}
        \vspace*{1ex}
        \begin{minipage}{\textwidth - 1.5ex}
}

\setbeamertemplate{block example end}
{
        \end{minipage}
    \vskip0pt
    \end{beamercolorbox}
    \vskip1.3ex
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{block alerted begin}
{
    \setbeamercolor{local structure}{use = block title alerted
                                     fg = block title alerted.bg}
    \setbeamercolor{item projected}{use = block title alerted,
                                    fg = block title alerted.fg,
                                    bg = block title alerted.bg}
    \setbeamercolor{description item}{use = alerted text, fg = alerted text.fg}
    \setbeamercolor{caption name}    {use = alerted text, fg = alerted text.fg}

    \unskip
    \vskip1.3ex

    \begin{beamercolorbox}[ht        = 2.4  ex,
                           dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex]
                          {block title alerted}

        \usebeamerfont*{block title alerted}
        \insertblocktitle
    \end{beamercolorbox}

    \nointerlineskip

    \usebeamerfont{block body alerted}
    \begin{beamercolorbox}[dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex,
                           vmode]
                          {block body alerted}
        \vspace*{1ex}
        \begin{minipage}{\textwidth - 1.5ex}
}

\setbeamertemplate{block alerted end}
{
    \end{minipage}
    \vskip0pt
    \end{beamercolorbox}
    \vskip1.3ex
}

\mode<all>

%% Translate environment names to Norwegian:
\uselanguage {\BearLang}
\languagepath{\BearLang}

\deftranslation[to = bm]{assumption} {antakelse}
\deftranslation[to = bm]{Assumption} {Antakelse}
\deftranslation[to = nn]{assumption} {f\o{}resetnad}
\deftranslation[to = nn]{Assumption} {F\o{}resetnad}
\deftranslation[to = bm]{axiom}      {aksiom}
\deftranslation[to = bm]{Axiom}      {Aksiom}
\deftranslation[to = nn]{axiom}      {aksiom}
\deftranslation[to = nn]{Axiom}      {Aksiom}
\deftranslation[to = bm]{calculation}{utregning}
\deftranslation[to = bm]{Calculation}{Utregning}
\deftranslation[to = nn]{calculation}{utrekning}
\deftranslation[to = nn]{Calculation}{Utrekning}
\deftranslation[to = bm]{computation}{beregning}
\deftranslation[to = bm]{Computation}{Beregning}
\deftranslation[to = nn]{computation}{berekning}
\deftranslation[to = nn]{Computation}{Berekning}
\deftranslation[to = bm]{conjecture} {formodning}
\deftranslation[to = bm]{Conjecture} {Formodning}
\deftranslation[to = nn]{conjecture} {forventing}
\deftranslation[to = nn]{Conjecture} {Forventing}
\deftranslation[to = bm]{corollary}  {korollar}
\deftranslation[to = bm]{Corollary}  {Korollar}
\deftranslation[to = nn]{corollary}  {korollar}
\deftranslation[to = nn]{Corollary}  {Korollar}
\deftranslation[to = bm]{definition} {definisjon}
\deftranslation[to = bm]{Definition} {Definisjon}
\deftranslation[to = nn]{definition} {definisjon}
\deftranslation[to = nn]{Definition} {Definisjon}
\deftranslation[to = bm]{definitions}{definisjoner}
\deftranslation[to = bm]{Definitions}{Definisjoner}
\deftranslation[to = nn]{definitions}{definisjonar}
\deftranslation[to = nn]{Definitions}{Definisjonar}
\deftranslation[to = bm]{example}    {eksempel}
\deftranslation[to = bm]{Example}    {Eksempel}
\deftranslation[to = nn]{example}    {d\o{}me}
\deftranslation[to = nn]{Example}    {D\o{}me}
\deftranslation[to = bm]{examples}   {eksempler}
\deftranslation[to = bm]{Examples}   {Eksempler}
\deftranslation[to = nn]{examples}   {d\o{}me}
\deftranslation[to = nn]{Examples}   {D\o{}me}
\deftranslation[to = bm]{fact}       {faktum}
\deftranslation[to = bm]{Fact}       {Faktum}
\deftranslation[to = nn]{fact}       {faktum}
\deftranslation[to = nn]{Fact}       {Faktum}
\deftranslation[to = bm]{facts}      {fakta}
\deftranslation[to = bm]{Facts}      {Fakta}
\deftranslation[to = nn]{facts}      {faktum}
\deftranslation[to = nn]{Facts}      {Faktum}
\deftranslation[to = bm]{hypothesis} {hypotese}
\deftranslation[to = bm]{Hypothesis} {Hypotese}
\deftranslation[to = nn]{hypothesis} {hypotese}
\deftranslation[to = nn]{Hypothesis} {Hypotese}
\deftranslation[to = bm]{notation}   {notasjon}
\deftranslation[to = bm]{Notation}   {Notasjon}
\deftranslation[to = nn]{notation}   {notasjon}
\deftranslation[to = nn]{Notation}   {Notasjon}
\deftranslation[to = bm]{observation}{observasjon}
\deftranslation[to = bm]{Observation}{Observasjon}
\deftranslation[to = nn]{observation}{observasjon}
\deftranslation[to = nn]{Observation}{Observasjon}
\deftranslation[to = bm]{property}   {egenskap}
\deftranslation[to = bm]{Property}   {Egenskap}
\deftranslation[to = nn]{property}   {eigenskap}
\deftranslation[to = nn]{Property}   {Eigenskap}
\deftranslation[to = bm]{proposition}{proposisjon}
\deftranslation[to = bm]{Proposition}{Proposisjon}
\deftranslation[to = nn]{proposition}{proposisjon}
\deftranslation[to = nn]{Proposition}{Proposisjon}
\deftranslation[to = bm]{remark}     {bemerkning}
\deftranslation[to = bm]{Remark}     {Bemerkning}
\deftranslation[to = nn]{remark}     {merknad}
\deftranslation[to = nn]{Remark}     {Merknad}
\deftranslation[to = bm]{remarks}    {bemerkninger}
\deftranslation[to = bm]{Remarks}    {Bemerkninger}
\deftranslation[to = nn]{remarks}    {merknadar}
\deftranslation[to = nn]{Remarks}    {Merknadar}
\deftranslation[to = bm]{theorem}    {teorem}
\deftranslation[to = bm]{Theorem}    {Teorem}
\deftranslation[to = nn]{theorem}    {teorem}
\deftranslation[to = nn]{Theorem}    {Teorem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Define additional theorem-like environments:
\declaretheorem[style   = plain,
                sibling = theorem,
                name    = {\translate[to=\BearLang]{Conjecture}}]
                {conjecture}
\declaretheorem[style   = plain,
                sibling = theorem,
                name    = {\translate[to=\BearLang]{Facts}}]
                {facts}
\declaretheorem[style   = plain,
                sibling = theorem,
                name    = {\translate[to=\BearLang]{Hypothesis}}]
                {hypothesis}
\declaretheorem[style   = plain,
                sibling = theorem,
                name    = {\translate[to=\BearLang]{Observation}}]
                {observation}
\declaretheorem[style   = plain,
                sibling = theorem,
                name    = {\translate[to=\BearLang]{Proposition}}]
                {proposition}
\declaretheorem[style = definition,
                name  = {\translate[to=\BearLang]{Assumption}}]
                {assumption}
\declaretheorem[style = definition,
                name  = {\translate[to=\BearLang]{Axiom}}]
                {axiom}
\declaretheorem[style = definition,
                name  = {\translate[to=\BearLang]{Property}}]
                {property}
\declaretheorem[style    = definition,
                numbered = no,
                name     = {\translate[to=\BearLang]{Calculation}}]
                {calculation}
\declaretheorem[style    = definition,
                numbered = no,
                name     = {\translate[to=\BearLang]{Computation}}]
                {computation}
\declaretheorem[style   = definition,
                sibling = theorem,
                name    = {\translate[to=\BearLang]{Notation}}]
                {notation}
\declaretheorem[style = remark,
                name  = {\translate[to=\BearLang]{Remark}}]
                {remark}
\declaretheorem[style   = remark,
                sibling = remark,
                name    = {\translate[to=\BearLang]{Remarks}}]
                {remarks}
                
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Added functionality of referencing enumerate-items as boxes

\newcommand{\enumref}[1]
{{
    \leavevmode\unskip
    \def\insertenumlabel{\ref{#1}}
    \usebeamertemplate*{enumerate item}
}}
